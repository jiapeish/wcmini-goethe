<view class="container">
  <!-- AI Info -->
  <view class="ai-info">
    <image class="avatar" src="/pages/images/assist.png" mode="aspectFill"></image>
    <text class="ai-name">⚡️AI助手</text>
  </view>

  <!-- Chat Area -->
  <scroll-view 
    class="messages" 
    scroll-y 
    scroll-into-view="msg-{{messages.length-1}}"
  >
    <!-- Welcome Message -->
    <view class="message assistant" wx:if="{{messages.length === 0}}">
      <view class="message-content">
        <text user-select="true">你好，我是AI助手。</text>
        <view class="message-footer">
          <button class="copy-btn" bindtap="copyMessage" data-text="你好，我是AI助手。">
            <text class="copy-icon">📋</text>
            <text>复制</text>
          </button>
        </view>
      </view>
    </view>

    <!-- Chat Messages -->
    <block wx:for="{{messages}}" wx:key="index">
      <view id="msg-{{index}}" class="message {{item.role === 'user' ? 'user' : 'assistant'}}">
        <view class="message-content">
          <text user-select="true">{{item.content}}</text>
          <view class="message-footer" wx:if="{{item.role === 'assistant'}}">
            <button 
              class="copy-btn"
              bindtap="copyMessage"
              data-text="{{item.content}}"
            >
              <text class="copy-icon">📋</text>
              <text>复制</text>
            </button>
          </view>
        </view>
      </view>
    </block>

    <!-- Suggested Questions -->
    <view class="suggestions" wx:if="{{messages.length === 0}}">
      <view class="suggestion-item" bindtap="handleSuggestion" data-text="你好，请介绍一下你自己。">
        你好，请介绍一下你自己。
      </view>
      <view class="suggestion-item" bindtap="handleSuggestion" data-text="你能帮我回答什么问题？">
        你能帮我回答什么问题？
      </view>
    </view>
  </scroll-view>

  <!-- Input Area -->
  <view class="input-area">
    <view style="position: relative;">
      <input 
        class="input"
        value="{{inputValue}}"
        placeholder="请将您遇到的问题告诉我"
        placeholder-class="input-placeholder"
        bindinput="handleInput"
        bindconfirm="sendMessage"
        confirm-type="send"
        maxlength="1024"
        disabled="{{!initialized || loading}}"
      />
      <view class="input-actions">
        <text class="char-count">{{inputValue.length}}/1024</text>
        <button 
          class="clear-btn"
          bindtap="clearMessages"
          wx:if="{{messages.length > 0}}"
        >
          <text class="clear-icon">🗑️</text>
        </button>
        <button 
          class="send-btn"
          bindtap="sendMessage"
          disabled="{{!initialized || loading || !inputValue}}"
        >
          <text class="send-icon">✈️</text>
        </button>
      </view>
    </view>
  </view>

  <!-- Footer -->
  <view class="footer">
    <text class="footer-text">❤️ Von Menschen, für Menschen – mit KI</text>
  </view>
</view>
